
<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>संलग्न दस्तावेज अपलोड</title>

<style>
body{
  font-family:Mangal,Arial;
  background:#f3f4f6;
  margin:20px
}
.card{
  background:#fff;
  padding:15px;
  border-radius:8px;
  margin-bottom:15px
}
table{
  width:100%;
  border-collapse:collapse
}
th,td{
  border:1px solid #000;
  padding:6px;
  font-size:14px
}
th{background:#eee}
.center{text-align:center}
.hidden{display:none}
button{
  padding:10px 20px;
  font-size:15px;
  cursor:pointer
}
.plus{
  font-size:20px;
  cursor:pointer;
  font-weight:bold;
}
.subRow td{
  background:#fafafa;
}
</style>
</head>

<body>

<h2>संलग्न दस्तावेज Only jpg/png</h2>

<div class="card">
<table>
<thead>
<tr>
<th>क्रम</th>
<th>दस्तावेज</th>
<th>हाँ</th>
<th>नहीं</th>
<th>अपलोड</th>
</tr>
</thead>
<tbody id="docTable"></tbody>
</table>
</div>

<!-- ===== LOCAL RESIDENT ===== -->
<div class="card hidden" id="localBox">
<b>स्थानीय निवासी (कोई 2 अनिवार्य)</b><br><br>

<label>
<input type="checkbox" class="localChk"> मतदाता पहचान पत्र
<input type="file" class="localFile hidden">
</label><br><br>

<label>
<input type="checkbox" class="localChk"> राशन कार्ड
<input type="file" class="localFile hidden">
</label><br><br>

<label>
<input type="checkbox" class="localChk"> आधार कार्ड
<input type="file" class="localFile hidden">
</label><br><br>

<label>
<input type="checkbox" class="localChk"> जन आधार कार्ड
<input type="file" class="localFile hidden">
</label>
</div>

<div class="center">
<button onclick="generatePDF()">PDF तैयार करें</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
const { jsPDF } = window.jspdf;

const documents = [
 "अधिकतम शैक्षणिक योग्यता सम्बन्धी अंकतालिका/प्रमाण पत्र",
 "NCTE मान्यता प्राप्त द्विवर्षीय NTT/DPSE/Bed/D.EL.Ed",
 "सैकण्डरी की अंकतालिका/प्रमाण पत्र",
 "हायर सैकण्डरी की अंकतालिका/प्रमाण पत्र",
 "स्थानीय निवासी प्रमाण पत्र",
 "अनुसूचित जाति/जनजाति/अल्पसंख्यक प्रमाण पत्र",
 "पिछड़ा वर्ग (OBC) प्रमाण पत्र",
 "EWS प्रमाण पत्र",
 "आदिम व घुमन्तु जाति प्रमाण पत्र",
 "दिव्यांग जन प्रमाण पत्र",
 "GNM/ANM/Nursing प्रमाण पत्र",
 "RSCIT / PGDCA प्रमाण पत्र",
 "आंगनबाडी अनुभव प्रमाण पत्र",
 "NCTE मान्यता प्राप्त NTT/DPSE/AB Ed/E EL Ed",
 "विधवा/तलाकशुदा प्रमाण पत्र",
 "अन्य"
];

const tbody = document.getElementById("docTable");
let otherIndex = 0;

documents.forEach((doc,i)=>{
 const isOther = doc === "अन्य";

 tbody.insertAdjacentHTML("beforeend",`
 <tr id="row${i}">
  <td class="center">${i+1}</td>

  <td>
    ${
      isOther
      ? `अन्य, इनके अलावा यदि आप अन्य दस्तावेज़ जोड़ना चाहते हैं
         <span class="plus" onclick="addOther()"> ➕</span>`
      : doc
    }
  </td>

  <td class="center">
    ${isOther ? `` :
      `<input type="radio" name="doc${i}" value="yes"
        onchange="docYes(${i})">`
    }
  </td>

  <td class="center">
    ${isOther ? `` :
      `<input type="radio" name="doc${i}" value="no"
        onchange="docNo(${i})">`
    }
  </td>

  <td>
    ${isOther ? `` :
      `<input type="file" id="file${i}" class="hidden">`
    }
  </td>
 </tr>
 `);
});

/* YES / NO */
function docYes(i){
 if(i===4){
  document.getElementById("localBox").classList.remove("hidden");
 }else{
  document.getElementById("file"+i).classList.remove("hidden");
 }
}
function docNo(i){
 if(i===4){
  document.getElementById("localBox").classList.add("hidden");
 }else{
  document.getElementById("file"+i).classList.add("hidden");
  document.getElementById("file"+i).value="";
 }
}

/* ===== ADD OTHER SUB DOCUMENT ===== */
function addOther(){
 const name = prompt("जिस दस्तावेज़ को जोड़ना चाहते हैं उसका नाम लिखें");
 if(!name) return;

 const id = `other_${otherIndex++}`;
 document.getElementById("row15").insertAdjacentHTML("afterend",`
 <tr class="subRow">
  <td></td>
  <td>${name}</td>
  <td class="center">
    <input type="radio" name="${id}" value="yes" onchange="toggleFile('${id}',true)">
  </td>
  <td class="center">
    <input type="radio" name="${id}" value="no" onchange="toggleFile('${id}',false)">
  </td>
  <td>
    <input type="file" id="file_${id}" class="hidden">
  </td>
 </tr>
 `);
}

function toggleFile(id,show){
 const f = document.getElementById("file_"+id);
 f.classList.toggle("hidden",!show);
 if(!show) f.value="";
}

/* ===== LOCAL LOGIC ===== */
const localChk=document.querySelectorAll(".localChk");
const localFile=document.querySelectorAll(".localFile");

localChk.forEach((c,i)=>{
 c.onchange=()=>{
  const sel=[...localChk].filter(x=>x.checked);
  if(sel.length>4){
   c.checked=false;
   alert("");
   return;
  }
  localFile[i].classList.toggle("hidden",!c.checked);
 };
});

/* ===== PDF ===== */
async function generatePDF(){
 const pdf=new jsPDF();
 let page=1;

 // main docs
 for(let i=0;i<documents.length;i++){
  if(i===4){
   const sel=[];
   localChk.forEach((c,idx)=>{
    if(c.checked && localFile[idx].files[0])
     sel.push(localFile[idx].files[0]);
   });
   if(sel.length!==2){alert("स्थानीय निवासी के 2 दस्तावेज अनिवार्य");return;}
   for(const f of sel) await add(pdf,f,page++);
   continue;
  }

  const yes=document.querySelector(`input[name=doc${i}][value=yes]`);
  if(yes?.checked){
   const f=document.getElementById("file"+i).files[0];
   if(!f){alert("सभी चयनित दस्तावेज अपलोड करें");return;}
   await add(pdf,f,page++);
  }
 }

 // other docs
 document.querySelectorAll("[id^=file_other_]").forEach(async f=>{
  if(f.files[0]) await add(pdf,f.files[0],page++);
 });

 pdf.save("documents.pdf");
}

async function add(pdf,file,page){
 const img=await read(file);
 pdf.addImage(img,"JPEG",10,10,190,260);
 pdf.text(`Page No. ${page}`,105,290,{align:"center"});
 pdf.addPage();
}

function read(f){
 return new Promise(r=>{
  const fr=new FileReader();
  fr.onload=e=>r(e.target.result);
  fr.readAsDataURL(f);
 });
}
</script>

</body>
</html>
